<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="keywords" content="C&#43;&#43;,Javascript,Node,Java,C#,编程,前端,Linux">
  <meta name="description" content="研究计算机程序设计">
  <meta name="author" content="leecjson">
  <meta property="og:title" content="Easy-GateWay 一个超方便的服务网关工具" />
<meta property="og:description" content="Headline2 Headline3 Headline4 Headline5 Headline6 class Database class Statement class Database new Database() Database#prepare() (see Statement) Database#transaction() Database#pragma() Database#backup() Database#function() Database#aggregate() Database#loadExtension() Database#exec() Database#close() Properties new Database(path, [options]) Creates a new database connection. If the database file does not exist, it is created. This happens synchronously, which means you can start executing queries right away. You can create an in-memory database by passing &quot;:memory:&quot; as the first argument. Various options" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/cs/get-started/" />
<meta property="article:published_time" content="2020-07-24T21:43:23+08:00" />
<meta property="article:modified_time" content="2020-07-24T21:43:23+08:00" />
<meta itemprop="name" content="Easy-GateWay 一个超方便的服务网关工具">
<meta itemprop="description" content="Headline2 Headline3 Headline4 Headline5 Headline6 class Database class Statement class Database new Database() Database#prepare() (see Statement) Database#transaction() Database#pragma() Database#backup() Database#function() Database#aggregate() Database#loadExtension() Database#exec() Database#close() Properties new Database(path, [options]) Creates a new database connection. If the database file does not exist, it is created. This happens synchronously, which means you can start executing queries right away. You can create an in-memory database by passing &quot;:memory:&quot; as the first argument. Various options">
<meta itemprop="datePublished" content="2020-07-24T21:43:23+08:00" />
<meta itemprop="dateModified" content="2020-07-24T21:43:23+08:00" />
<meta itemprop="wordCount" content="3519">



<meta itemprop="keywords" content="C&#43;&#43;,JavaScript,程序设计," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Easy-GateWay 一个超方便的服务网关工具"/>
<meta name="twitter:description" content="Headline2 Headline3 Headline4 Headline5 Headline6 class Database class Statement class Database new Database() Database#prepare() (see Statement) Database#transaction() Database#pragma() Database#backup() Database#function() Database#aggregate() Database#loadExtension() Database#exec() Database#close() Properties new Database(path, [options]) Creates a new database connection. If the database file does not exist, it is created. This happens synchronously, which means you can start executing queries right away. You can create an in-memory database by passing &quot;:memory:&quot; as the first argument. Various options"/>
<title>Easy-GateWay 一个超方便的服务网关工具 | 秃猫李的电子博客</title>

  <link rel="stylesheet"
    href="../../dist/hash/fontawesome.84d8ad2b4fcdc0f0c58247e778133b3a/css/all.min.css">
  <link rel="stylesheet"
    href="../../dist/hash/main.53ce060416d691e5fe3f.css">
</head>
<body>
  
  <header class="app__topbar elevation-z4">
    <a class="app__brand" href="../../">秃猫李的电子博客</a>
    <div class="app__topbar-link-list">
      <a target="_blank" class="app__topbar-link" href="https://github.com/leecjson"><i class="fab fa-github"></i></a>
    </div>
  </header>
  

  <main>
  <article class="markdown-body">
    <h1>Easy-GateWay 一个超方便的服务网关工具</h1><h2 id="headline2">Headline2</h2>
<h3 id="headline3">Headline3</h3>
<h4 id="headline4">Headline4</h4>
<h5 id="headline5">Headline5</h5>
<h6 id="headline6">Headline6</h6>
<ul>
<li><a href="#class-database">class <code>Database</code></a></li>
<li><a href="#class-statement">class <code>Statement</code></a></li>
</ul>
<h1 id="class-database">class <em>Database</em></h1>
<ul>
<li><a href="#new-databasepath-options">new Database()</a></li>
<li><a href="#preparestring---statement">Database#prepare()</a> (see <a href="#class-statement"><code>Statement</code></a>)</li>
<li><a href="#transactionfunction---function">Database#transaction()</a></li>
<li><a href="#pragmastring-options---results">Database#pragma()</a></li>
<li><a href="#backupdestination-options---promise">Database#backup()</a></li>
<li><a href="#functionname-options-function---this">Database#function()</a></li>
<li><a href="#aggregatename-options---this">Database#aggregate()</a></li>
<li><a href="#loadextensionpath-entrypoint---this">Database#loadExtension()</a></li>
<li><a href="#execstring---this">Database#exec()</a></li>
<li><a href="#close---this">Database#close()</a></li>
<li><a href="#properties">Properties</a></li>
</ul>
<h3 id="new-databasepath-options">new Database(<em>path</em>, [<em>options</em>])</h3>
<p>Creates a new database connection. If the database file does not exist, it is created. This happens synchronously, which means you can start executing queries right away. You can create an <a href="https://www.sqlite.org/inmemorydb.html">in-memory database</a> by passing <code>&quot;:memory:&quot;</code> as the first argument.</p>
<p>Various options are accepted:</p>
<ul>
<li>
<p><code>options.readonly</code>: open the database connection in readonly mode (default: <code>false</code>).</p>
</li>
<li>
<p><code>options.fileMustExist</code>: if the database does not exist, an <code>Error</code> will be thrown instead of creating a new file. This option does not affect in-memory or readonly database connections (default: <code>false</code>).</p>
</li>
<li>
<p><code>options.timeout</code>: the number of milliseconds to wait when executing queries on a locked database, before throwing a <code>SQLITE_BUSY</code> error (default: <code>5000</code>).</p>
</li>
<li>
<p><code>options.verbose</code>: provide a function that gets called with every SQL string executed by the database connection (default: <code>null</code>).</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Database</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;better-sqlite3&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">db</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Database</span>(<span style="color:#e6db74">&#39;foobar.db&#39;</span>, { <span style="color:#a6e22e">verbose</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span> });
</code></pre></div><h3 id="preparestring---statement">.prepare(<em>string</em>) -&gt; <em>Statement</em></h3>
<p>Creates a new prepared <a href="#class-statement"><code>Statement</code></a> from the given SQL string.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT name, age FROM cats&#39;</span>);
</code></pre></div><h3 id="transactionfunction---function">.transaction(<em>function</em>) -&gt; <em>function</em></h3>
<p>Creates a function that always runs inside a <a href="https://sqlite.org/lang_transaction.html">transaction</a>. When the function is invoked, it will begin a new transaction. When the function returns, the transaction will be committed. If an exception is thrown, the transaction will be rolled back (and the exception will propagate as usual).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">insert</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO cats (name, age) VALUES (@name, @age)&#39;</span>);

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">insertMany</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">transaction</span>((<span style="color:#a6e22e">cats</span>) =&gt; {
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cat</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">cats</span>) <span style="color:#a6e22e">insert</span>.<span style="color:#a6e22e">run</span>(<span style="color:#a6e22e">cat</span>);
});

<span style="color:#a6e22e">insertMany</span>([
  { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Joey&#39;</span>, <span style="color:#a6e22e">age</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span> },
  { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Sally&#39;</span>, <span style="color:#a6e22e">age</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span> },
  { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Junior&#39;</span>, <span style="color:#a6e22e">age</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span> },
]);
</code></pre></div><p>Transaction functions can be called from inside other transaction functions. When doing so, the inner transaction becomes a <a href="https://www.sqlite.org/lang_savepoint.html">savepoint</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newExpense</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO expenses (note, dollars) VALUES (?, ?)&#39;</span>);

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">adopt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">transaction</span>((<span style="color:#a6e22e">cats</span>) =&gt; {
  <span style="color:#a6e22e">newExpense</span>.<span style="color:#a6e22e">run</span>(<span style="color:#e6db74">&#39;adoption fees&#39;</span>, <span style="color:#ae81ff">20</span>);
  <span style="color:#a6e22e">insertMany</span>(<span style="color:#a6e22e">cats</span>); <span style="color:#75715e">// nested transaction
</span><span style="color:#75715e"></span>});
</code></pre></div><p>Transactions also come with <code>deferred</code>, <code>immediate</code>, and <code>exclusive</code> versions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">insertMany</span>(<span style="color:#a6e22e">cats</span>); <span style="color:#75715e">// uses &#34;BEGIN&#34;
</span><span style="color:#75715e"></span><span style="color:#a6e22e">insertMany</span>.<span style="color:#a6e22e">deferred</span>(<span style="color:#a6e22e">cats</span>); <span style="color:#75715e">// uses &#34;BEGIN DEFERRED&#34;
</span><span style="color:#75715e"></span><span style="color:#a6e22e">insertMany</span>.<span style="color:#a6e22e">immediate</span>(<span style="color:#a6e22e">cats</span>); <span style="color:#75715e">// uses &#34;BEGIN IMMEDIATE&#34;
</span><span style="color:#75715e"></span><span style="color:#a6e22e">insertMany</span>.<span style="color:#a6e22e">exclusive</span>(<span style="color:#a6e22e">cats</span>); <span style="color:#75715e">// uses &#34;BEGIN EXCLUSIVE&#34;
</span></code></pre></div><p>Any arguments passed to the transaction function will be forwarded to the wrapped function, and any values returned from the wrapped function will be returned from the transaction function. The wrapped function will also have access to the same <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this"><code>this</code></a> binding as the transaction function.</p>
<h4 id="caveats">Caveats</h4>
<p>If you&rsquo;d like to manage transactions manually, you&rsquo;re free to do so with regular <a href="#preparestring---statement">prepared statements</a> (using <code>BEGIN</code>, <code>COMMIT</code>, etc.). However, manually managed transactions should not be mixed with transactions managed by this <code>.transaction()</code> method. In other words, using raw <code>COMMIT</code> or <code>ROLLBACK</code> statements inside a transaction function is not supported.</p>
<p>Transaction functions do not work with async functions. Technically speaking, async functions always return after the first <code>await</code>, which means the transaction will already be committed before any async code executes. Also, because SQLite3 serializes all transactions, it&rsquo;s generally a very bad idea to keep a transaction open across event loop ticks anyways.</p>
<p>It&rsquo;s important to know that SQLite3 may sometimes rollback a transaction without us asking it to. This can happen either because of an <a href="https://sqlite.org/lang_conflict.html"><code>ON CONFLICT</code></a> clause, the <a href="https://www.sqlite.org/lang_createtrigger.html"><code>RAISE()</code></a> trigger function, or certain errors such as <code>SQLITE_FULL</code> or <code>SQLITE_BUSY</code>. In other words, if you catch an SQLite3 error <em>within</em> a transaction, you must be aware that any futher SQL that you execute might not be within the same transaction. Usually, the best course of action for such cases is to simply re-throw the error, exiting the transaction function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">try</span> {
  ...
} <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">inTransaction</span>) <span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">err</span>; <span style="color:#75715e">// (transaction was forcefully rolled back)
</span><span style="color:#75715e"></span>  ...
}
</code></pre></div><h3 id="pragmastring-options---results">.pragma(<em>string</em>, [<em>options</em>]) -&gt; <em>results</em></h3>
<p>Executes the given PRAGMA and returns its result. By default, the return value will be an array of result rows. Each row is represented by an object whose keys correspond to column names.</p>
<p>Since most PRAGMA statements return a single value, the <code>simple</code> option is provided to make things easier. When <code>simple</code> is <code>true</code>, only the first column of the first row will be returned.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">pragma</span>(<span style="color:#e6db74">&#39;cache_size = 32000&#39;</span>);
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">pragma</span>(<span style="color:#e6db74">&#39;cache_size&#39;</span>, { <span style="color:#a6e22e">simple</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> })); <span style="color:#75715e">// =&gt; 32000
</span></code></pre></div><p>If execution of the PRAGMA fails, an <code>Error</code> is thrown.</p>
<p>It&rsquo;s better to use this method instead of normal <a href="#preparestring---statement">prepared statements</a> when executing PRAGMA, because this method normalizes some odd behavior that may otherwise be experienced. The documentation on SQLite3 PRAGMA can be found <a href="https://www.sqlite.org/pragma.html">here</a>.</p>
<h3 id="backupdestination-options---promise">.backup(<em>destination</em>, [<em>options</em>]) -&gt; <em>promise</em></h3>
<p>Initiates a <a href="https://www.sqlite.org/backup.html">backup</a> of the database, returning a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">promise</a> for when the backup is complete. If the backup fails, the promise will be rejected with an <code>Error</code>. You can optionally backup an attached database by setting the <code>attached</code> option to the name of the desired attached database.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">backup</span>(<span style="color:#e6db74">`backup-</span><span style="color:#e6db74">${</span>Date.<span style="color:#a6e22e">now</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">.db`</span>)
  .<span style="color:#a6e22e">then</span>(() =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;backup complete!&#39;</span>);
  })
  .<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">err</span>) =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;backup failed:&#39;</span>, <span style="color:#a6e22e">err</span>);
  });
</code></pre></div><p>You can continue to use the database normally while a backup is in progress. If the same database connection mutates the database while performing a backup, those mutations will be reflected in the backup automatically. However, if a <em>different</em> connection mutates the database during a backup, the backup will be forcefully restarted. Therefore, it&rsquo;s recommended that only a single connection is responsible for mutating the database if online backups are being performed.</p>
<p>You can monitor the progress of the backup by setting the <code>progress</code> option to a callback function. That function will be invoked every time the backup makes progress, providing an object with two properties:</p>
<ul>
<li><code>.totalPages</code>: the total number of pages in the source database (and thus, the number of pages that the backup will have when completed) at the time of this progress report.</li>
<li><code>.remainingPages</code>: the number of pages that still must be transferred before the backup is complete.</li>
</ul>
<p>By default, <code>100</code> <a href="https://www.sqlite.org/fileformat.html#pages">pages</a> will be transferred after each cycle of the event loop. However, you can change this setting as often as you like by returning a number from the <code>progress</code> callback. You can even return <code>0</code> to effectively pause the backup altogether. In general, the goal is to maximize throughput while reducing pause times. If the transfer size is very low, pause times will be low, but it may take a while to complete the backup. On the flip side, if the setting is too high, pause times will be greater, but the backup might complete sooner. In most cases, <code>100</code> has proven to be a strong compromise, but the best setting is dependent on your computer&rsquo;s specifications and the nature of your program. Do not change this setting without measuring the effectiveness of your change. You should not assume that your change will even have the intended effect, unless you measure it for your unique situation.</p>
<p>If the backup is successful, the returned promise will contain an object that has the same properties as the one provided to the <code>progress</code> callback, but <code>.remainingPages</code> will be <code>0</code>. If the <code>progress</code> callback throws an exception, the backup will be aborted. Usually this happens due to an unexpected error, but you can also use this behavior to voluntarily cancel the backup operation. If the parent database connection is closed, all pending backups will be automatically aborted.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">paused</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">backup</span>(<span style="color:#e6db74">`backup-</span><span style="color:#e6db74">${</span>Date.<span style="color:#a6e22e">now</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">.db`</span>, {
  <span style="color:#a6e22e">progress</span>({ <span style="color:#a6e22e">totalPages</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">remainingPages</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span> }) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`progress: </span><span style="color:#e6db74">${</span>((<span style="color:#a6e22e">t</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">r</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>).<span style="color:#a6e22e">toFixed</span>(<span style="color:#ae81ff">1</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">%`</span>);
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">paused</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span>;
  }
});
</code></pre></div><h3 id="functionname-options-function---this">.function(<em>name</em>, [<em>options</em>], <em>function</em>) -&gt; <em>this</em></h3>
<p>Registers a user-defined <code>function</code> so that it can be used by SQL statements.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#66d9ef">function</span>(<span style="color:#e6db74">&#39;add2&#39;</span>, (<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) =&gt; <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>);

<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT add2(?, ?)&#39;</span>).<span style="color:#a6e22e">pluck</span>().<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">4</span>); <span style="color:#75715e">// =&gt; 16
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT add2(?, ?)&#39;</span>).<span style="color:#a6e22e">pluck</span>().<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;foo&#39;</span>, <span style="color:#e6db74">&#39;bar&#39;</span>); <span style="color:#75715e">// =&gt; &#34;foobar&#34;
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT add2(?, ?, ?)&#39;</span>).<span style="color:#a6e22e">pluck</span>().<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">18</span>); <span style="color:#75715e">// =&gt; Error: wrong number of arguments
</span></code></pre></div><p>By default, user-defined functions have a strict number of arguments (determined by <code>function.length</code>). You can register multiple functions of the same name, each with a different number of arguments, causing SQLite3 to execute a different function depending on how many arguments were passed to it. If you register two functions with same name and the same number of arguments, the second registration will erase the first one.</p>
<p>If <code>options.varargs</code> is <code>true</code>, the registered function can accept any number of arguments.</p>
<p>If your function is <a href="https://en.wikipedia.org/wiki/Deterministic_algorithm">deterministic</a>, you can set <code>options.deterministic</code> to <code>true</code>, which may improve performance under some circumstances.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#66d9ef">function</span>(<span style="color:#e6db74">&#39;void&#39;</span>, { <span style="color:#a6e22e">deterministic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">varargs</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }, () =&gt; {});

<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;SELECT void()&#34;</span>).<span style="color:#a6e22e">pluck</span>().<span style="color:#a6e22e">get</span>(); <span style="color:#75715e">// =&gt; null
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;SELECT void(?, ?)&#34;</span>).<span style="color:#a6e22e">pluck</span>().<span style="color:#a6e22e">get</span>(<span style="color:#ae81ff">55</span>, <span style="color:#ae81ff">19</span>); <span style="color:#75715e">// =&gt; null
</span></code></pre></div><h3 id="aggregatename-options---this">.aggregate(<em>name</em>, <em>options</em>) -&gt; <em>this</em></h3>
<p>Registers a user-defined <a href="https://sqlite.org/lang_aggfunc.html">aggregate function</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">aggregate</span>(<span style="color:#e6db74">&#39;addAll&#39;</span>, {
  <span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
  <span style="color:#a6e22e">step</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">total</span>, <span style="color:#a6e22e">nextValue</span>) =&gt; <span style="color:#a6e22e">total</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nextValue</span>,
});

<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT addAll(dollars) FROM expenses&#39;</span>).<span style="color:#a6e22e">pluck</span>().<span style="color:#a6e22e">get</span>(); <span style="color:#75715e">// =&gt; 92
</span></code></pre></div><p>The <code>step()</code> function will be invoked once for each row passed to the aggregate, using its return value as the new aggregate value. This works similarly to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">Array#reduce()</a>.</p>
<p>If <code>options.start</code> is a function, it will be invoked at the beginning of each aggregate, using its return value as the initial aggregate value. If <code>options.start</code> is <em>not</em> a function, it will be used as the initial aggregate value <em>as-is</em> (shown in the example above). If not provided, the initial aggregate value will be <code>null</code>.</p>
<p>You can also provide a <code>result()</code> function to transform the final aggregate value:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">aggregate</span>(<span style="color:#e6db74">&#39;getAverage&#39;</span>, {
  <span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> () =&gt; [],
  <span style="color:#a6e22e">step</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">array</span>, <span style="color:#a6e22e">nextValue</span>) =&gt; {
    <span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">nextValue</span>);
  },
  <span style="color:#a6e22e">result</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">array</span> =&gt; <span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">reduce</span>(<span style="color:#a6e22e">sum</span>) <span style="color:#f92672">/</span> <span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">length</span>,
});

<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT getAverage(dollars) FROM expenses&#39;</span>).<span style="color:#a6e22e">pluck</span>().<span style="color:#a6e22e">get</span>(); <span style="color:#75715e">// =&gt; 20.2
</span></code></pre></div><p>As shown above, you can use arbitrary JavaScript objects as your aggregation context, as long as a valid SQLite3 value is returned by <code>result()</code> in the end. If <code>step()</code> doesn&rsquo;t return anything (<code>undefined</code>), the aggregate value will not be replaced (be careful of this when using functions that return <code>undefined</code> when <code>null</code> is desired).</p>
<p>Just like regular <a href="#functionname-options-function---this">user-defined functions</a>, user-defined aggregates can accept multiple arguments. Furthermore, <code>options.varargs</code> and <code>options.deterministic</code> <a href="#functionname-options-function---this">are also</a> accepted.</p>
<p>If you provide an <code>inverse()</code> function, the aggregate can be used as a <a href="https://www.sqlite.org/windowfunctions.html">window function</a>. Where <code>step()</code> is used to add a row to the current window, <code>inverse()</code> is used to remove a row from the current window. When using window functions, <code>result()</code> may be invoked multiple times.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">aggregate</span>(<span style="color:#e6db74">&#39;addAll&#39;</span>, {
  <span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>,
  <span style="color:#a6e22e">step</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">total</span>, <span style="color:#a6e22e">nextValue</span>) =&gt; <span style="color:#a6e22e">total</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">nextValue</span>,
  <span style="color:#a6e22e">inverse</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">total</span>, <span style="color:#a6e22e">droppedValue</span>) =&gt; <span style="color:#a6e22e">total</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">droppedValue</span>,
  <span style="color:#a6e22e">result</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">total</span> =&gt; Math.<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">total</span>),
});

<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">`
</span><span style="color:#e6db74">  SELECT timestamp, dollars, addAll(dollars) OVER day as dayTotal
</span><span style="color:#e6db74">  FROM expenses
</span><span style="color:#e6db74">  WINDOW day AS (PARTITION BY date(timestamp))
</span><span style="color:#e6db74">  ORDER BY timestamp
</span><span style="color:#e6db74">`</span>).<span style="color:#a6e22e">all</span>();
</code></pre></div><h3 id="loadextensionpath-entrypoint---this">.loadExtension(<em>path</em>, [<em>entryPoint</em>]) -&gt; <em>this</em></h3>
<p>Loads a compiled <a href="https://sqlite.org/loadext.html">SQLite3 extension</a> and applies it to the current database connection.</p>
<p>It&rsquo;s your responsibility to make sure the extensions you load are compiled/linked against a version of <a href="https://www.sqlite.org/">SQLite3</a> that is compatible with <code>better-sqlite3</code>. Keep in mind that new versions of <code>better-sqlite3</code> will periodically use newer versions of <a href="https://www.sqlite.org/">SQLite3</a>. You can see which version is being used <a href="./compilation.md#bundled-configuration">here</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">loadExtension</span>(<span style="color:#e6db74">&#39;./my-extensions/compress.so&#39;</span>);
</code></pre></div><h3 id="execstring---this">.exec(<em>string</em>) -&gt; <em>this</em></h3>
<p>Executes the given SQL string. Unlike <a href="#preparestring---statement">prepared statements</a>, this can execute strings that contain multiple SQL statements. This function performs worse and is less safe than using <a href="#preparestring---statement">prepared statements</a>. You should only use this method when you need to execute SQL from an external source (usually a file). If an error occurs, execution stops and further statements are not executed. You must rollback changes manually.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">migration</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">readFileSync</span>(<span style="color:#e6db74">&#39;migrate-schema.sql&#39;</span>, <span style="color:#e6db74">&#39;utf8&#39;</span>);
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">exec</span>(<span style="color:#a6e22e">migration</span>);
</code></pre></div><h3 id="close---this">.close() -&gt; <em>this</em></h3>
<p>Closes the database connection. After invoking this method, no statements can be created or executed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;exit&#39;</span>, () =&gt; <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">close</span>());
<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;SIGHUP&#39;</span>, () =&gt; <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">128</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>));
<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;SIGINT&#39;</span>, () =&gt; <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">128</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>));
<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;SIGTERM&#39;</span>, () =&gt; <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">128</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">15</span>));
</code></pre></div><h2 id="properties">Properties</h2>
<p><strong>.open -&gt; <em>boolean</em></strong> - Whether the database connection is currently open.</p>
<p><strong>.inTransaction -&gt; <em>boolean</em></strong> - Whether the database connection is currently in an open transaction.</p>
<p><strong>.name -&gt; <em>string</em></strong> - The string that was used to open the database connection.</p>
<p><strong>.memory -&gt; <em>boolean</em></strong> - Whether the database is an in-memory database.</p>
<p><strong>.readonly -&gt; <em>boolean</em></strong> - Whether the database connection was created in readonly mode.</p>
<h1 id="class-statement">class <em>Statement</em></h1>
<p>An object representing a single SQL statement.</p>
<ul>
<li><a href="#runbindparameters---object">Statement#run()</a></li>
<li><a href="#getbindparameters---row">Statement#get()</a></li>
<li><a href="#allbindparameters---array-of-rows">Statement#all()</a></li>
<li><a href="#iteratebindparameters---iterator">Statement#iterate()</a></li>
<li><a href="#plucktogglestate---this">Statement#pluck()</a></li>
<li><a href="#expandtogglestate---this">Statement#expand()</a></li>
<li><a href="#rawtogglestate---this">Statement#raw()</a></li>
<li><a href="#columns---array-of-objects">Statement#columns()</a></li>
<li><a href="#bindbindparameters---this">Statement#bind()</a></li>
<li><a href="#properties-1">Properties</a></li>
</ul>
<h3 id="runbindparameters---object">.run([<em>&hellip;bindParameters</em>]) -&gt; <em>object</em></h3>
<p>*<em>(only on statements that do not return data)</em></p>
<p>Executes the prepared statement. When execution completes it returns an <code>info</code> object describing any changes made. The <code>info</code> object has two properties:</p>
<ul>
<li><code>info.changes</code>: the total number of rows that were inserted, updated, or deleted by this operation. Changes made by <a href="https://www.sqlite.org/foreignkeys.html#fk_actions">foreign key actions</a> or <a href="https://www.sqlite.org/lang_createtrigger.html">trigger programs</a> do not count.</li>
<li><code>info.lastInsertRowid</code>: the <a href="https://www.sqlite.org/lang_createtable.html#rowid">rowid</a> of the last row inserted into the database (ignoring those caused by <a href="https://www.sqlite.org/lang_createtrigger.html">trigger programs</a>). If the current statement did not insert any rows into the database, this number should be completely ignored.</li>
</ul>
<p>If execution of the statement fails, an <code>Error</code> is thrown.</p>
<p>You can specify <a href="#binding-parameters">bind parameters</a>, which are only bound for the given execution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO cats (name, age) VALUES (?, ?)&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">info</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">run</span>(<span style="color:#e6db74">&#39;Joey&#39;</span>, <span style="color:#ae81ff">2</span>);

<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">info</span>.<span style="color:#a6e22e">changes</span>); <span style="color:#75715e">// =&gt; 1
</span></code></pre></div><h3 id="getbindparameters---row">.get([<em>&hellip;bindParameters</em>]) -&gt; <em>row</em></h3>
<p>*<em>(only on statements that return data)</em></p>
<p>Executes the prepared statement. When execution completes it returns an object that represents the first row retrieved by the query. The object&rsquo;s keys represent column names.</p>
<p>If the statement was successful but found no data, <code>undefined</code> is returned. If execution of the statement fails, an <code>Error</code> is thrown.</p>
<p>You can specify <a href="#binding-parameters">bind parameters</a>, which are only bound for the given execution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT age FROM cats WHERE name = ?&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;Joey&#39;</span>);

<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">age</span>); <span style="color:#75715e">// =&gt; 2
</span></code></pre></div><h3 id="allbindparameters---array-of-rows">.all([<em>&hellip;bindParameters</em>]) -&gt; <em>array of rows</em></h3>
<p>*<em>(only on statements that return data)</em></p>
<p>Similar to <a href="#getbindparameters---row"><code>.get()</code></a>, but instead of only retrieving one row all matching rows will be retrieved. The return value is an array of row objects.</p>
<p>If no rows are found, the array will be empty. If execution of the statement fails, an <code>Error</code> is thrown.</p>
<p>You can specify <a href="#binding-parameters">bind parameters</a>, which are only bound for the given execution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT * FROM cats WHERE name = ?&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cats</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">all</span>(<span style="color:#e6db74">&#39;Joey&#39;</span>);

<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">cats</span>.<span style="color:#a6e22e">length</span>); <span style="color:#75715e">// =&gt; 1
</span></code></pre></div><h3 id="iteratebindparameters---iterator">.iterate([<em>&hellip;bindParameters</em>]) -&gt; <em>iterator</em></h3>
<p>*<em>(only on statements that return data)</em></p>
<p>Similar to <a href="#allbindparameters---array-of-rows"><code>.all()</code></a>, but instead of returning every row together, an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols">iterator</a> is returned so you can retrieve the rows one by one. If you plan on retrieving every row anyways, <a href="#allbindparameters---array-of-rows"><code>.all()</code></a> will perform slightly better.</p>
<p>If execution of the statement fails, an <code>Error</code> is thrown and the iterator is closed.</p>
<p>You can specify <a href="#binding-parameters">bind parameters</a>, which are only bound for the given execution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT * FROM cats&#39;</span>);

<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cat</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">iterate</span>()) {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;Joey&#39;</span>) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;found him!&#39;</span>);
    <span style="color:#66d9ef">break</span>;
  }
}
</code></pre></div><h3 id="plucktogglestate---this">.pluck([toggleState]) -&gt; <em>this</em></h3>
<p>*<em>(only on statements that return data)</em></p>
<p>Causes the prepared statement to only return the value of the first column of any rows that it retrieves, rather than the entire row object.</p>
<p>You can toggle this on/off as you please:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">pluck</span>(); <span style="color:#75715e">// plucking ON
</span><span style="color:#75715e"></span><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">pluck</span>(<span style="color:#66d9ef">true</span>); <span style="color:#75715e">// plucking ON
</span><span style="color:#75715e"></span><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">pluck</span>(<span style="color:#66d9ef">false</span>); <span style="color:#75715e">// plucking OFF
</span></code></pre></div><blockquote>
<p>When plucking is turned on, <a href="#expandtogglestate---this">expansion</a> and <a href="#rawtogglestate---this">raw mode</a> are turned off (they are mutually exclusive options).</p>
</blockquote>
<h3 id="expandtogglestate---this">.expand([toggleState]) -&gt; <em>this</em></h3>
<p>*<em>(only on statements that return data)</em></p>
<p>Causes the prepared statement to return data namespaced by table. Each key in a row object will be a table name, and each corresponding value will be a nested object that contains the associated column data. This is useful when performing a <code>JOIN</code> between two tables that have overlapping column names. If a result column is an expression or subquery, it will be available within the special <code>$</code> namespace.</p>
<p>You can toggle this on/off as you please:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">expand</span>(); <span style="color:#75715e">// expansion ON
</span><span style="color:#75715e"></span><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">expand</span>(<span style="color:#66d9ef">true</span>); <span style="color:#75715e">// expansion ON
</span><span style="color:#75715e"></span><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">expand</span>(<span style="color:#66d9ef">false</span>); <span style="color:#75715e">// expansion OFF
</span></code></pre></div><blockquote>
<p>When expansion is turned on, <a href="#plucktogglestate---this">plucking</a> and <a href="#rawtogglestate---this">raw mode</a> are turned off (they are mutually exclusive options).</p>
</blockquote>
<h3 id="rawtogglestate---this">.raw([toggleState]) -&gt; <em>this</em></h3>
<p>*<em>(only on statements that return data)</em></p>
<p>Causes the prepared statement to return rows as arrays instead of objects. This is primarily used as a performance optimization when retrieving a very high number of rows. Column names can be recovered by using the <a href="#columns---array-of-objects"><code>.columns()</code></a> method.</p>
<p>You can toggle this on/off as you please:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">raw</span>(); <span style="color:#75715e">// raw mode ON
</span><span style="color:#75715e"></span><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">raw</span>(<span style="color:#66d9ef">true</span>); <span style="color:#75715e">// raw mode ON
</span><span style="color:#75715e"></span><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">raw</span>(<span style="color:#66d9ef">false</span>); <span style="color:#75715e">// raw mode OFF
</span></code></pre></div><blockquote>
<p>When raw mode is turned on, <a href="#plucktogglestate---this">plucking</a> and <a href="#expandtogglestate---this">expansion</a> are turned off (they are mutually exclusive options).</p>
</blockquote>
<h3 id="columns---array-of-objects">.columns() -&gt; <em>array of objects</em></h3>
<p>*<em>(only on statements that return data)</em></p>
<p>This method is primarily used in conjunction with <a href="#rawtogglestate---this">raw mode</a>. It returns an array of objects, where each object describes a result column of the prepared statement. Each object has the following properties:</p>
<ul>
<li><code>.name</code>: the name (or alias) of the result column.</li>
<li><code>.column</code>: the name of the originating table column, or <code>null</code> if it&rsquo;s an expression or subquery.</li>
<li><code>.table</code>: the name of the originating table, or <code>null</code> if it&rsquo;s an expression or subquery.</li>
<li><code>.database</code>: the name of the originating database, or <code>null</code> if it&rsquo;s an
expression or subquery.</li>
<li><code>.type</code>: the name of the <a href="https://www.sqlite.org/datatype3.html#determination_of_column_affinity">declared type</a>, or <code>null</code> if it&rsquo;s an expression or subquery.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;fs&#39;</span>);

<span style="color:#66d9ef">function</span><span style="color:#f92672">*</span> <span style="color:#a6e22e">toRows</span>(<span style="color:#a6e22e">stmt</span>) {
  <span style="color:#66d9ef">yield</span> <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">columns</span>().<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">column</span> =&gt; <span style="color:#a6e22e">column</span>.<span style="color:#a6e22e">name</span>);
  <span style="color:#66d9ef">yield</span><span style="color:#f92672">*</span> <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">raw</span>().<span style="color:#a6e22e">iterate</span>();
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">writeToCSV</span>(<span style="color:#a6e22e">filename</span>, <span style="color:#a6e22e">stmt</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stream</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">createWriteStream</span>(<span style="color:#a6e22e">filename</span>);
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">row</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">toRows</span>(<span style="color:#a6e22e">stmt</span>)) {
      <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">row</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;,&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\n&#39;</span>);
    }
    <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;error&#39;</span>, <span style="color:#a6e22e">reject</span>);
    <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">end</span>(<span style="color:#a6e22e">resolve</span>);
  });
}
</code></pre></div><blockquote>
<p>When a table&rsquo;s schema is altered, existing prepared statements might start returning different result columns. However, such changes will not be reflected by this method until the prepared statement is re-executed. For this reason, it&rsquo;s perhaps better to invoke <code>.columns()</code> <em>after</em> <code>.get()</code>, <code>.all()</code>, or <code>.iterate()</code>.</p>
</blockquote>
<h3 id="bindbindparameters---this">.bind([<em>&hellip;bindParameters</em>]) -&gt; <em>this</em></h3>
<p><a href="#binding-parameters">Binds the given parameters</a> to the statement <em>permanently</em>. Unlike binding parameters upon execution, these parameters will stay bound to the prepared statement for its entire life.</p>
<p>After a statement&rsquo;s parameters are bound this way, you may no longer provide it with execution-specific (temporary) bound parameters.</p>
<p>This method is primarily used as a performance optimization when you need to execute the same prepared statement many times with the same bound parameters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;SELECT * FROM cats WHERE name = ?&#39;</span>).<span style="color:#a6e22e">bind</span>(<span style="color:#e6db74">&#39;Joey&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">get</span>();

<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">cat</span>.<span style="color:#a6e22e">name</span>); <span style="color:#75715e">// =&gt; &#34;Joey&#34;
</span></code></pre></div><h2 id="properties-1">Properties</h2>
<p><strong>.database -&gt; <em>object</em></strong> - The parent database object.</p>
<p><strong>.source -&gt; <em>string</em></strong> - The source string that was used to create the prepared statement.</p>
<p><strong>.reader -&gt; <em>boolean</em></strong> - Whether the prepared statement returns data.</p>
<h1 id="binding-parameters">Binding Parameters</h1>
<p>This section refers to anywhere in the documentation that specifies the optional argument [<em><code>...bindParameters</code></em>].</p>
<p>There are many ways to bind parameters to a prepared statement. The simplest way is with anonymous parameters:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO people VALUES (?, ?, ?)&#39;</span>);

<span style="color:#75715e">// The following are equivalent.
</span><span style="color:#75715e"></span><span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">run</span>(<span style="color:#e6db74">&#39;John&#39;</span>, <span style="color:#e6db74">&#39;Smith&#39;</span>, <span style="color:#ae81ff">45</span>);
<span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">run</span>([<span style="color:#e6db74">&#39;John&#39;</span>, <span style="color:#e6db74">&#39;Smith&#39;</span>, <span style="color:#ae81ff">45</span>]);
<span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">run</span>([<span style="color:#e6db74">&#39;John&#39;</span>], [<span style="color:#e6db74">&#39;Smith&#39;</span>, <span style="color:#ae81ff">45</span>]);
</code></pre></div><p>You can also use named parameters. SQLite3 provides <a href="https://www.sqlite.org/lang_expr.html">3 different syntaxes for named parameters</a> (<code>@foo</code>, <code>:foo</code>, and <code>$foo</code>), all of which are supported by <code>better-sqlite3</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// The following are equivalent.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO people VALUES (@firstName, @lastName, @age)&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO people VALUES (:firstName, :lastName, :age)&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO people VALUES ($firstName, $lastName, $age)&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO people VALUES (@firstName, :lastName, $age)&#39;</span>);

<span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">run</span>({
  <span style="color:#a6e22e">firstName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;John&#39;</span>,
  <span style="color:#a6e22e">lastName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Smith&#39;</span>,
  <span style="color:#a6e22e">age</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">45</span>
});
</code></pre></div><p>Below is an example of mixing anonymous parameters with named parameters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stmt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#39;INSERT INTO people VALUES (@name, @name, ?)&#39;</span>);
<span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">run</span>(<span style="color:#ae81ff">45</span>, { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Henry&#39;</span> });
</code></pre></div><h1 id="hello-world">Hello World</h1>
<p>MySQL锁</p>
<h2 id="锁">锁</h2>
<p>Insert</p>
<h4 id="模型">模型</h4>
<p>$ y_{ij} = h_i + a_j + e_{ij} $
其中
$ y_{ij} = $ 第i个牧场第j头奶牛的产奶量，即表型观测值</p>
<p>$ h_{i} = $ 第i个牧场对奶牛的效应值，即固定环境效应</p>
<h4 id="矩阵形式">矩阵形式</h4>
<p>$ y = Xh + Za + e $</p>
<h4 id="假定">假定</h4>
<p>$$ E(a) = E(e) = 0 \<br>
Var(a) = G = {\sigma_a}^2 * A
Var(e) = R = {\sigma_e}^2 * I $$
其中随机因子构成的矩阵为<strong>G矩阵</strong>，残差构成的矩阵是<strong>R矩阵</strong>，A是<strong>亲缘关系矩阵</strong></p>
<h4 id="混合线性方程组">混合线性方程组</h4>
<p>$$ \begin{bmatrix}
X&rsquo;X &amp; X&rsquo;Z \<br>
Z&rsquo;X &amp; Z&rsquo;Z + A^{-1}K \end{bmatrix}
\begin{bmatrix}
\widehat{\mu} \<br>
\widehat{\alpha} \end{bmatrix}=
\begin{bmatrix} X&rsquo;Y \ Z&rsquo;Y \end{bmatrix} $$
其中$A_{-1}$ 是A的逆矩阵，X&rsquo;是X的关系矩阵，Z&rsquo;是Z的关系矩阵，$ k = \frac{{\sigma_e}^2}{{\sigma_a}^2} $</p>
<h3 id="个体育种值估计的准确性">个体育种值估计的准确性</h3>
<blockquote>
<p>育种值的准确性：由估计育种值与真实育种值之间的相关系数$r_{a_i\widehat{a_j}}$来度量。其公式为 $$ r_{a_i\widehat{a_j}} = \frac{Cov(a_i,\widehat{a_i})}{\sigma_{a_i}\sigma_{\widehat{a_i}}} = \sqrt{\frac{{\sigma_a}^2 - d_{a_i}{\sigma_e^2}} {{\sigma_a}^2}} = \sqrt{1 - \frac{se^2}{{\sigma_a}^2}}  \ $$ 其中， $ d_{ai}*Ve $是BLUP的标准误的平方，如果更进一步考虑，也可以考虑近交系数。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">error</span> <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">NotLoggedInError</span>) {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">chalk</span>.<span style="color:#a6e22e">redBright</span>(<span style="color:#e6db74">&#39;Not Login Yet&#39;</span>));
} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((<span style="color:#a6e22e">error</span> <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">APIError</span>) <span style="color:#f92672">||</span> (<span style="color:#a6e22e">error</span> <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">HTTPError</span>)) {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">chalk</span>.<span style="color:#a6e22e">redBright</span>(<span style="color:#a6e22e">error</span>.<span style="color:#a6e22e">toString</span>()));
} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">error</span> <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">MessageError</span>) {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">chalk</span>.<span style="color:#a6e22e">redBright</span>(<span style="color:#a6e22e">error</span>.<span style="color:#a6e22e">message</span>));
} <span style="color:#66d9ef">else</span> {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">error</span>);
}
</code></pre></div><pre><code></code></pre><p><br /></p>
<p><img src="@ref(./img.png)" alt="sdasda0"></p>
<h2 id="header-id">Test</h2>
</article>
</main>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>
</body>

</html>